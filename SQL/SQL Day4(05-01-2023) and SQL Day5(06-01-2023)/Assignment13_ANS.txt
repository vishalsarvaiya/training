=========================================================================================
DATABASE :
=========================================================================================

Assume a hypothetical company that manages multiple automobile dealerships throughout INDIA.

Following are the data requirements of our company :

* A "car" is described by a vehicle identification number (VIN), make (e.g., Toyota), model (e.g., Prius), year, mileage, 
and two prices: the asking price (how much the dealership would like to sell the car for) and 
the invoice price (how much the dealership paid for the car). This information is maintained for every car currently in any 
dealership's inventory, and also for every car that has ever been sold by one of the dealerships. 

* A dealership is a single location where the company sells cars. The company manages many dealerships, each one being described 
by a unique dealership ID, a name (e.g., Honda Sales, Yamaha World, Concept Hyundai etc.), street address, city, and state.

* The company employs a number of salespeople. Each salesperson is assigned a unique salesperson ID. 

* Salespeople work at one or more dealerships each month, and are paid a monthly base salary at each, regardless of how many cars 
they sell. Additionally, they are paid a commission on each car they sell. 

* Information is maintained about all salespeople who ever worked for any dealership.

* The following information is kept about each customer : ID, name, street address, city, and state.

* Salespeople are arranged in a strict hierarchy, with each salesperson reporting to a "managing salesperson."

* It is necessary to keep track of the inventory of cars currently available at each dealership. Of course, a particular car can only 
be in the inventory of one dealership at any given time.

* A long-term record of all car sales is maintained. For each sale, the company tracks which car was bought, which customer bought it,
 which salesperson sold it, which dealership it was sold by, at which price it was sold for, and on which date it was sold.

   i. car (recid, vin, make, model, year, mileage, askprice, invoiceprice)
  ii. dealership (recid, name, address, city, state)
 iii. salesperson (recid, name)
  iv. customer (recid, name, address, city, state)
   v. reportsto (recid, salespersonid, managingsalespersonid)  salespersonid, managingsalespersonid
  vi. worksat (recid, salespersonid, dealershipid, monthworked, basesalaryformonth) salespersonid, dealershipid,
 vii. inventory (recid, vin, dealershipid)  dealershipid
viii. sale (recid, vin, customerid, salespersonid, dealershipid, saleprice, saledate) customerid, salespersonid, dealershipid,


i. car (recid, vin, make, model, year, mileage, askprice, invoiceprice)
create table vishalcar
(
recid int(5) primary key auto_increment,
vin numeric(5) not null,
make varchar(20) not null,
model varchar(20) not null,
year numeric(4) not null,
mileage numeric(2) not null,
askprice numeric(7) not null,
invoiceprice numeric(7) not null
);

insert into vishalcar (vin,make,model,year,mileage,askprice,invoiceprice) values
(1000,'tata moters','Tata Nexon','2022',20,770000,500000),
(1002,'tata moters','Tata Harrier','2021',15,1700000,1500000),
(1003,'Mahindra','Mahindra Thar','2022',18,1200000,1000000),
(1004,'Mahindra','Mahindra XUV700','2019',30,2000000,1800000),
(1005,'Mahindra','Mahindra Bolero.','2020',10,2500000,2200000);


ii. dealership (recid, name, address, city, state)
create table vishaldealership 
(
recid int(5) primary key auto_increment,
name varchar(20) not null,
address varchar(50) not null,
city varchar(20) not null,
state varchar(30) not null
);


insert into vishaldealership(name, address, city, state) values
('Tata moters dealer 1','sola road','ahmedabad','gujrat'),
('Tata moters dealer 2','iscon road','ahmedabad','gujrat'),
('Mahindra dealer 1','kargil road','ahmedabad','gujrat'),
('Mahindra dealer 2','damru circle road','ahmedabad','gujrat');


iii. salesperson (recid, name)
create table vishalsalesperson 
(
recid int(5) primary key auto_increment,
name varchar(20) not null
);


insert into vishalsalesperson(name) values
('name1'),('name2'),('name3'),('name4'),('name5'),('name6'),('name7'),('name8');

insert into  vishalsalesperson(name) values
('name9'),('name10'),('name11'),('name12');

iv. customer (recid, name, address, city, state)
create table Vishalcustomer 
(
recid int(5) primary key auto_increment,
name varchar(20) not null,
address varchar(50) not null,
city varchar(20) not null,
state varchar(30) not null
);


insert into Vishalcustomer(name, address, city, state) values
('customer1','area1 sector1','ahmedabad','gujarat'),
('customer2','area2 sector2','ahmedabad','gujarat'),
('customer3','area3 sector3','ahmedabad','gujarat'),
('customer4','area4 sector4','ahmedabad','gujarat'),
('customer5','area5 sector5','ahmedabad','gujarat'),
('customer6','area6 sector6','ahmedabad','gujarat'),
('customer7','area7 sector7','ahmedabad','gujarat'),
('customer8','area8 sector8','ahmedabad','gujarat'),
('customer9','area9 sector9','ahmedabad','gujarat'),
('customer10','area10 sector10','ahmedabad','gujarat');

v. reportsto (recid, salespersonid, managingsalespersonid)
create table vishalreportsto
(
recid int(5) primary key auto_increment,
salespersonid numeric(5) not null references salesperson(recid),
managingsalespersonid numeric(5) not null references salesperson(recid),
);


insert into vishalreportsto(salespersonid, managingsalespersonid) values
(1,3),
(2,3),
(4,6),
(5,6),
(7,9),
(8,9),
(10,12),
(11,12);

vi. worksat (recid, salespersonid, dealershipid, monthworked, basesalaryformonth) salespersonid, dealershipid,
create table vishalworksat
(
recid int(5) primary key auto_increment,
salespersonid numeric(5) not null references salesperson(recid),
dealershipid numeric(5) not null references dealership(recid),
monthworked numeric(3) not null,
basesalaryformonth numeric(6) not null
);


insert into vishalworksat(salespersonid, dealershipid, monthworked, basesalaryformonth) values
(1,1,4,60000),
(2,1,5,61000),
(3,1,8,70000),
(4,2,4,50000),
(5,2,5,51000),
(6,2,8,60000),
(7,3,4,40000),
(8,3,5,41000),
(9,3,8,50000),
(10,4,4,30000),
(11,4,5,31000),
(12,4,8,40000);

vii. inventory (recid, vin, dealershipid)  dealershipid
create table vishalinventory 
(
recid int(5) primary key auto_increment,
vin numeric(5) not null references vishalcar(recid),
dealershipid numeric(5) not null references dealership(recid)
);


insert into vishalinventory( vin, dealershipid) values
(1000,1),(1001,1),(1002,1),(1002,1),(1002,1),
(1000,2),(1001,2),(1001,2),(1002,2),(1002,2),
(1003,3),(1003,3),(1003,3),(1004,3),(1004,3),
(1003,4),(1003,4),(1004,4),(1004,4),(1004,4);


viii. sale (recid, vin, customerid, salespersonid, dealershipid, saleprice, saledate) customerid, salespersonid, dealershipid,
create table vishalsale
(
recid int(5) primary key auto_increment,
vin numeric(5) not null references vishalcar(recid),
customerid numeric(5) not null references customer(recid),
salespersonid numeric(5) not null references salesperson(recid),
dealershipid numeric(5) not null references dealership(recid),
saleprice numeric(7) not null,
saledate DATE not null 
);


insert into vishalsale 
(vin, customerid, salespersonid, dealershipid, saleprice, saledate) values
(1001,1,1,1,770000,'2022-12-31'),
(1001,2,2,1,770000,'2022-12-01'),
(1002,3,1,1,1700000,'2022-11-30'),
(1002,4,4,2,1700000,'2022-11-01'),
(1001,5,5,2,770000,'2022-10-13'),
(1003,6,7,3,1200000,'2022-12-22'),
(1003,7,10,4,1200000,'2022-12-31'),
(1004,8,7,3,2000000,'2022-01-01'),
(1004,9,10,4,2000000,'2022-01-03'),
(1004,10,9,4,2000000,'2022-01-13');




=========================================================================================
QUERIES :
=========================================================================================


1. Find the names of all salespeople who have ever worked for the company at any dealership.
select s.name as "salesperson" , d.name as "company" from vishalsalesperson s inner join vishalworksat w
on s.recid = w.salespersonid 
inner join 
vishaldealership d
on w.dealershipid = d.recid;


2. List the Name, Street Address, and City of each customer who lives in Ahmedabad.
select name,address,city from Vishalcustomer
where city = "ahmedabad";



3. List the VIN, make, model, year, and mileage of all cars in the inventory of the dealership named "Hero Honda Car World".
select c.vin, c.make, c.model, c.year, c.mileage from vishalcar c inner join vishalinventory i
on c.vin = i.vin
inner join
vishaldealership d
on i.dealershipid = d.recid
where d.name = "Tata moters dealer 1";
 

4. List names of all customers who have ever bought cars from the dealership named "Concept Hyundai".
select c.name,d.name from Vishalcustomer c inner join vishalsale s
on c.recid = s.customerid
inner join
vishaldealership d
on s.dealershipid = d.recid
where d.name = "Tata moters dealer 1";

5. For each car in the inventory of any dealership, list the VIN, make, model, and year of the car, 
along with the name, city, and state of the dealership whose inventory contains the car.

select distinct c.vin, c.make, c.model, c.year, d.name, d.city, d.state 
from vishalinventory i inner join vishaldealership d
on i.dealershipid = d.recid
inner join
vishalcar c
on c.vin = i.vin;

6. Find the names of all salespeople who are managed by a salesperson named "Adam Smith".
select s.name from vishalsalesperson s inner join vishalreportsto r
on r.salespersonid = s.recid
where r.managingsalespersonid in(select s.recid from vishalsalesperson s where s.name = "name3");

7. Find the names of all salespeople who do not have a manager.
select s.name from vishalsalesperson s inner join vishalreportsto r
on r.salespersonid = s.recid
where r.managingsalespersonid = 0;

8. Find the total number of dealerships.
select count(recid) from vishaldealership;

9. List the VIN, year, and mileage of all "Toyota Camrys" in the inventory of the dealership named "Toyota Performance". 
(Note that a "Toyota Camry" is indicated by the make being "Toyota" and the model being "Camry".)

select c.vin, c.model, c.year, c.mileage from vishalcar c inner join vishalinventory i
on c.vin = i.vin
inner join
vishaldealership d
on i.dealershipid = d.recid
where c.model = "tata Nexon" AND d.name = "Tata moters dealer 1";

10. Find the name of all customers who bought a car at a dealership located in a state other than the state in which they live.
select c.name from Vishalcustomer c inner join vishalsale s
on c.recid = s.customerid
inner join
vishaldealership d
on d.recid = s.dealershipid
where c.state != d.state;


11. Find the name of the salesperson that made the largest base salary working at the dealership 
named "Ferrari Sales" during January 2007.
select sa.name from vishalsalesperson as sa inner join vishalworksat as sale
on sa.recid=sale.salespersonid
inner join vishaldealership as deal
on sale.dealershipid=deal.recid
where deal.name='Tata moters dealer 1'and basesalaryformonth in(select max(basesalaryformonth) from vishalworksat);


12. Find the salesperson ID and name of all salespeople who have worked at each one of the 
company's dealerships at some point in time.
select s.recid,s.name
from vishalworksat w, vishalsalesperson s
where s.recid = w.salespersonid
group by s.recid,s.name,w.dealershipid
having (select count(recid) from vishaldealership) = count(w.dealershipid);


13. List the name, street address, city, and state of any customer who has bought 
more than two cars from all dealerships combined since January 1, 2007.
select cust.name,address,city,state,count(sale.customerid) from Vishalcustomer as cust inner join vishalsale as sale
where cust.recid=sale.customerid
group by sale.customerid
having count(sale.customerid)>2;


14. List the name, salesperson ID, and total sales amount for each salesperson who has ever sold at least one car. 
The total sales amount for a salesperson is the sum of the sale prices of all cars ever sold by that salesperson.
select salep.name, sale.salespersonid, sum(sale.saleprice) from vishalsale as sale inner join vishalsalesperson as salep
on sale.salespersonid=salep.recid
group by sale.salespersonid;

15. Find the names of all customers who bought cars during 2007 who were also salespeople during 2007. 
For the purpose of this query, assume that no two people have the same name.
select c.name from Vishalcustomer c, vishalsale s , vishalsalesperson sp
where s.customerid = c.recid and sp.recid=s.salespersonid
and s.saledate between '2007-01-01' and '2007-12-31'
group by c.name;


16. Find the name and salesperson ID of the salesperson who sold the most cars for the company at dealerships located in 
Gujarat between March 1, 2007 and March 31, 2007.
select sa.name,sale.salespersonid from vishalsalesperson as sa inner join vishalsale as sale
on sa.recid=sale.salespersonid inner join vishaldealership as de
on sale.dealershipid=de.recid where de.state='Gujarat' and saledate between '2022-01-01' and '2023-01-01';



17. Calculate the payroll for the month of March 2007.
	* The payroll consists of the name, salesperson ID, and gross pay for each salesperson who worked that month.
        * The gross pay is calculated as the base salary at each dealership employing the salesperson that month, 
along with the total commission for the salesperson that month.
        * The total commission for a salesperson in a month is calculated as 5% of the profit made on all cars sold 
by the salesperson that month.
        * The profit made on a car is the difference between the sale price and the invoice price of the car.
 (Assume, that cars are never sold for less than the invoice price.)



select s.name,s.recid, (basesalaryformonth + (((saleprice-invoiceprice)/100)*5)) as 'gross pay'
from vishalsale sl inner join vishalcar c
on sl.vin = c.vin
inner join
vishalworksat w
on w.salespersonid = sl.salespersonid
inner join 
vishalsalesperson s
on s.recid = sl.salespersonid;




